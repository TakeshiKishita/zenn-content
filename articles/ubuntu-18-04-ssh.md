---
title: "Ubuntu 18.04 セットアップ（SSH編）"
date: 2019-02-02T08:24:00.002Z
slug: ubuntu-18-04-ssh
---






Ubuntu 18.04 セットアップ（SSH編）



# Ubuntu 18.04 インストール後のSSH設定


Ubuntuマシンを組むので、せっかくだしセットアップ手順を忘れないようにメモしておきます。


## 環境


* Ubuntu 18.04 Desktop インストール後のPC


* 同じネットワーク内にクライアントPC  

無線LANルータを使用している場合など、２重ルータになっていないよう確認してください。  

ネット接続に問題は無いと思いますが、SSHを使用する場合、正しくつながらない場合があります。  

その場合はルーターのブリッジ機能等の設定をしてください。


* Ubuntuマシンのip固定


* 外部から接続する場合、必要なIP、ポートが開放されたルーター




GUIで出来る事は、できるだけGUIで済ませます。


## やること


今回は外からの接続設定もするので、セキュリティ、ポート周り等の設定を行います。  

家庭内LANだけで使用する場合はあまり設定の必要はないと思います。


* sshd\_configの設定
	+ ポート変更
	+ rootログインの無効
	+ パスワード認証の無効
* 家庭内LANの別端末からのSSH接続
* ファイアウォールの設定
* 外部ネットワークからのSSH接続


## やらないこと


* Ubuntuのインストール
* ルーターの設定
* コマンドの細かい解説


あくまでUbuntuの設定を記録するつもりなので、ルーターの開放等はここには書きません。


## まずは


SSHで接続できるよう、openssh-servreを入れます。



```
sudo apt install openssh-server

```

**※外部からSSH、もしくはパスワード認証を無効にしてSSHをする場合は、  

公開鍵を下記ファイルに登録してから作業してください。接続できなくなってしまいます**


`.ssh/authorized_keys`  

詳しいやり方は[こちら](https://qiita.com/HamaTech/items/21bb9761f326c4d4aa65)が参考になると思います。


## sshd\_configの設定


家庭内LANだけで使用する場合、セキュリティ的に特に設定が必要無い場合は  

読み飛ばしてください。



```
# ポートの変更
#Port 22
Port 1234 #好きなポート番号

# rootログインの無効
#PermitRootLogin prohibit-password
PermitRootLogin no

# パスワード認証の無効
#PasswordAuthentication yes
PasswordAuthentication no

```

## 家庭内LANの別端末からのSSH接続


サービスリスタートして、無事にSSH出来るか確認しましょう。



```
# Ubuntuサーバー側
sudo systemctl restart sshd.service

```


```
# クライアントPC側
# ssh {ユーザー名}@{IPアドレス} -p {ポート番号}
ssh hoge@192.168.1.2 -p 1234

```

## ファイアウォールの設定


ファイアウォールを手軽に設定するため、gufwをインストールします。  

ターミナルから



```
sudo apt install gufw

```

もしくは、UbuntuソフトウェアでGUIからインストールします。  

インストール後、SSHで設定したポートを追加しましょう。  

[こちら](https://sicklylife.jp/ubuntu/1804/gufw.html)の記事が参考になります。


## 外部からSSH接続確認


**※ここでは紹介しませんが、各ルーター毎にポート開放が必要になります。  

間違った設定をするとセキュリティ的にも良くないので、よく確認の上設定してください。**


ホスト端末の接続を切り替えて、Ubuntu端末のグローバルを調べたら、外部からアクセスしてみましょう。


同じ環境からグローバルアドレスを指定しても、接続できません。


自身のグローバルアドレスはいろいろなサイトで確認できます。  

ブラウザでアクセスしてもいいですし、コマンドの場合は一例ですが、下記のように確認できます。



```
curl globalip.me

```

取得したIPを元に、後は宅内LANの時と同じ要領で接続できるハズです。



```
# ssh {ユーザー名}@{IPアドレス} -p {ポート番号}
ssh hoge@xxx.xxx.xxx.xxx -p 1234

```




